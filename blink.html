<!DOCTYPE html>
<meta charset="utf-8">
<title>HDR Blink (Canvas like TestUFO)</title>
<style>
    html,body { height:100%; margin:0; background:#000; display:grid; place-items:center; }
    canvas { width:80vw; height:80vh; display:block; }
</style>
<canvas id="c" width="1600" height="800"></canvas>
<script>
    function hslToRgb(h, s, l) {
        // h in [0,360), s and l in [0,1]
        s /= 100;
        l /= 100;
        const c = (1 - Math.abs(2*l - 1)) * s;
        const x = c * (1 - Math.abs((h/60) % 2 - 1));
        const m = l - c/2;
        let r=0,g=0,b=0;

        if (0 <= h && h < 60) [r,g,b] = [c,x,0];
        else if (60 <= h && h < 120) [r,g,b] = [x,c,0];
        else if (120 <= h && h < 180) [r,g,b] = [0,c,x];
        else if (180 <= h && h < 240) [r,g,b] = [0,x,c];
        else if (240 <= h && h < 300) [r,g,b] = [x,0,c];
        else if (300 <= h && h < 360) [r,g,b] = [c,0,x];

        return [r+m, g+m, b+m];
    }

    function hslRec2020String(h,s,l,scale=1) {
        const [r,g,b] = hslToRgb(h,s,l);
        return `color(rec2020 ${r*scale} ${g*scale} ${b*scale})`;
    }


    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d', {
        colorSpace: 'rec2100-pq',
        pixelFormat: 'float16',   // current Chrome flag path
        alpha: false              // critical: keep opaque, stay on HDR path
    });

    if (!ctx) {
        document.body.insertAdjacentHTML('afterbegin',
            '<div style="color:#fff;position:fixed;top:0;left:0;padding:8px">No HDR canvas context</div>');
    }

    ctx.font = '900 220px system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    let on = false;
    function frame(t){
        ctx.fillStyle = 'rgb(0 0 0)';  // opaque clear
        ctx.fillRect(0,0,canvas.width,canvas.height);

        // SDR white vs "HDR bright" (rec2020 on a rec2100-pq canvas, per TestUFO note)
        ctx.fillStyle = on ? hslRec2020String(150,100,50,3) : 'hsl(150 100 50)';
        const text = 'HDR ' + (on? 'ON' : 'OFF');
        ctx.fillText(text, canvas.width/2, canvas.height/2);

        on = !on;
        setTimeout(()=>requestAnimationFrame(frame), 800); // ~800ms blink
    }
    requestAnimationFrame(frame);
</script>
